<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Meta Tags -->
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Panel | Sub Category</title>
    <meta name="description"
        content="A modern CRM Dashboard Template with reusable and flexible components for your SaaS web applications by hencework. Based on Bootstrap." />

    <!-- Favicon -->
    <link rel="shortcut icon" href="/dist/img/favicon.png">
    <link rel="icon" href="favicon.ico" type="image/x-icon">

    <!-- Bootstrap Dropify CSS -->
    <link href="/vendors/dropify/dist/css/dropify.min.css" rel="stylesheet" type="text/css" />

    <!-- select2 CSS -->
    <link href="/vendors/select2/dist/css/select2.min.css" rel="stylesheet" type="text/css" />

    <!-- Data Table CSS -->
    <link href="/vendors/datatables.net-bs5/css/dataTables.bootstrap5.min.css" rel="stylesheet" type="text/css" />
    <link href="/vendors/datatables.net-responsive-bs5/css/responsive.bootstrap5.min.css" rel="stylesheet"
        type="text/css" />

    <!-- CSS -->
    <link href="/dist/css/style.css" rel="stylesheet" type="text/css">
    <!-- Toastr  -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.0.1/css/toastr.css" rel="stylesheet" />

    <style>
        .dot-active {
            margin-left: 10px;
            height: 13px;
            width: 13px;
            background-color: rgb(19, 170, 19);
            border-radius: 50%;
            display: inline-block;
        }

        .dot-deactive {
            margin-left: 10px;
            height: 13px;
            width: 13px;
            background-color: rgb(224, 59, 37);
            border-radius: 50%;
            display: inline-block;
        }

        .contact-toolbar-left{
            display: none;
        }
    </style>

</head>

<body style="font-size: 15px;">
    <!-- Wrapper -->
    <div class="hk-wrapper" data-layout="vertical" data-layout-style="collapsed" data-menu="light" data-footer="simple"
        data-hover="active">

        <!-- /Header -->
        <%- include('includes/header.ejs'); %>

            <!-- Vertical Nav -->
            <div class="hk-menu">
                <!-- Brand -->
                <div class="menu-header">
                    <span>
                        <a class="navbar-brand" href="/home">
                            <img class="brand-img img-fluid" src="/dist/img/icon.png" width="45" height="70" alt="Logo"
                                style="padding-bottom: 10px; padding-top: 15px;" />
                            <span
                                style="font-family: 'Barlow',sans-serif; font-size: 14px; font-weight: bold;padding-left: 10px;">KANDY
                                PHARMACY</span>
                        </a>

                        <button class="btn btn-icon btn-rounded btn-flush-dark flush-soft-hover navbar-toggle">
                            <span class="icon">
                                <span class="svg-icon fs-5">
                                    <svg xmlns="http://www.w3.org/2000/svg"
                                        class="icon icon-tabler icon-tabler-arrow-bar-to-left" width="24" height="24"
                                        viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none"
                                        stroke-linecap="round" stroke-linejoin="round">
                                        <path stroke="none" d="M0 0h24v24H0z" fill="none"></path>
                                        <line x1="10" y1="12" x2="20" y2="12"></line>
                                        <line x1="10" y1="12" x2="14" y2="16"></line>
                                        <line x1="10" y1="12" x2="14" y2="8"></line>
                                        <line x1="4" y1="4" x2="4" y2="20"></line>
                                    </svg>
                                </span>
                            </span>
                        </button>
                    </span>
                </div>
                <!-- /Brand -->

                <!-- /Navbar -->
                <%- include('includes/navbar.ejs'); %>

            </div>
            <div id="hk_menu_backdrop" class="hk-menu-backdrop"></div>
            <!-- /Vertical Nav -->

            <!-- Main Content -->
            <div class="hk-pg-wrapper pb-0">
                <div class="container-xxl">
                    <!-- Page Header -->
                    <div class="hk-pg-header">
                        <h1 class="pg-title">Sub Category</h1>
                    </div>
                    <!-- /Page Header -->

                    <div class="col-sm" style="border: 2px solid #edeef1; padding: 20px;">
                        
                            <div class="row gx-3 align-items-center">
                                <div class="col-xl-auto mb-xl-0 mb-2" style="min-width: 400px;">
                                <form class="form-inline p-3 bg-grey-light-5" id="formSubCat" action="/subcategory/add" method="post">
                                <input type="hidden" value="<%=current_user.auth.token%>" name="accessToken">
                                <input type="hidden" value="<%=current_user.employee.username%>" name="emp_code">
                                
                                    <select class="form-select" name="category_code" id="category_code">
                                        <option disabled selected>Select Category</option>
                                        <% if(catlist != null){ for (let cat of catlist){ %>
                                            <option value="<%=cat.Code%>">
                                                <%=cat.Name%>
                                            </option>
                                            <% } } %>
                                    </select>
                                </div>
                                <div class="col-xl-auto mb-xl-0 mb-2" style="min-width: 400px;">
                                    <input class="form-control" type="text" name="sub_category_name"
                                        placeholder="Sub Category Name" />
                                </div>
                                <input type="submit" style="display: none;" />
                            </form>  
                                <div class="col-xl-auto mb-xl-0 mb-2">
                                    <button class="btn btn-sm btn-primary" id="btnSave">Save Sub Category</button>
                                </div>
                            </div>
                        
                    </div>


                    <!-- Page Body -->
                    <div class="hk-pg-body">
                        <div class="tab-content">
                            <div class="tab-pane fade show active" id="tab_block_1">
                                <div class="row">
                                    <div class="col-md-12 mb-md-4 mb-3">
                                        <div class="card card-border mb-0 h-100">
                                            <div class="card-body">
                                                <div class="contact-list-view">
                                                    <table id="datable_1" class="table nowrap w-100 mb-5">
                                                        <thead>
                                                            <tr>
                                                                <th><span class="form-check fs-6 mb-0">
                                                                        <input type="checkbox"
                                                                            class="form-check-input check-select-all"
                                                                            id="customCheck1">
                                                                        <label class="form-check-label"
                                                                            for="customCheck1"></label></span>
                                                                </th>
                                                                <th>Main Category Name</th>
                                                                <th>Category Name</th>
                                                                <th>Name</th>
                                                                <th>Status</th>
                                                                <th style="text-align: center;">Actions</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody>
                                                            <% if(subcatlist != null){ for (let subcat of subcatlist){ %>
                                                                <tr>
                                                                    <td></td>
                                                                    <td class="text-truncate">
                                                                        <%=subcat.EcomCategoryName%>
                                                                    </td>
                                                                    <td>
                                                                        <%=subcat.EcomSubCategory1Name%>
                                                                    </td>
                                                                    <td>
                                                                        <%=subcat.Name%>
                                                                    </td>
                                                                    <td>
                                                                        <% if(subcat.IsActive==true){ %>
                                                                            <span class="dot-active"></span>
                                                                            <% } else { %>
                                                                                <span class="dot-deactive"></span>
                                                                                <% } %>
                                                                    </td>
                                                                    <td>
                                                                        <div class="d-flex align-items-center">
                                                                            <div class="d-flex" style="padding-left: 90px;">
                                                                                <a class="btn btn-icon btn-flush-dark btn-rounded flush-soft-hover"
                                                                                    data-bs-toggle="modal"
                                                                                    data-bs-target="#view_info"
                                                                                    data-id="<%=subcat.Code%>"
                                                                                    data-bs-toggle="tooltip"
                                                                                    data-placement="top" title=""
                                                                                    data-bs-original-title="View"
                                                                                    id="openViewModal" href="">
                                                                                    <span class="svg-icon">
                                                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                                                            width="16" height="16"
                                                                                            fill="currentColor"
                                                                                            class="bi bi-eye"
                                                                                            viewBox="0 0 16 16">
                                                                                            <path
                                                                                                d="M16 8s-3-5.5-8-5.5S0 8 0 8s3 5.5 8 5.5S16 8 16 8zM1.173 8a13.133 13.133 0 0 1 1.66-2.043C4.12 4.668 5.88 3.5 8 3.5c2.12 0 3.879 1.168 5.168 2.457A13.133 13.133 0 0 1 14.828 8c-.058.087-.122.183-.195.288-.335.48-.83 1.12-1.465 1.755C11.879 11.332 10.119 12.5 8 12.5c-2.12 0-3.879-1.168-5.168-2.457A13.134 13.134 0 0 1 1.172 8z" />
                                                                                            <path
                                                                                                d="M8 5.5a2.5 2.5 0 1 0 0 5 2.5 2.5 0 0 0 0-5zM4.5 8a3.5 3.5 0 1 1 7 0 3.5 3.5 0 0 1-7 0z" />
                                                                                        </svg>
                                                                                    </span>
                                                                                </a>

                                                                                <a class="btn btn-icon btn-flush-dark btn-rounded flush-soft-hover"
                                                                                    data-bs-toggle="modal"
                                                                                    data-bs-target="#edit_info"
                                                                                    data-id="<%=subcat.Code%>:<%=subcat.Name%>"
                                                                                    data-bs-toggle="tooltip"
                                                                                    data-placement="top" title=""
                                                                                    data-bs-original-title="Edit"
                                                                                    id="openEditModal" href="">
                                                                                    <span class="svg-icon">
                                                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                                                            width="24" height="24"
                                                                                            viewBox="0 0 24 24"
                                                                                            fill="none"
                                                                                            stroke="currentColor"
                                                                                            stroke-width="2"
                                                                                            stroke-linecap="round"
                                                                                            stroke-linejoin="round"
                                                                                            class="feather feather-edit">
                                                                                            <path
                                                                                                d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7">
                                                                                            </path>
                                                                                            <path
                                                                                                d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z">
                                                                                            </path>
                                                                                        </svg>
                                                                                    </span>
                                                                                </a>

                                                                                <a class="btn btn-icon btn-flush-dark btn-rounded flush-soft-hover del-button"
                                                                                    data-bs-toggle="modal"
                                                                                    style="color: red;"
                                                                                    data-bs-toggle="tooltip"
                                                                                    data-id="<%=subcat.Code%>"
                                                                                    data-placement="top" title=""
                                                                                    data-bs-original-title="Delete"
                                                                                    id="openDeleteModal" href="#">
                                                                                    <span class="svg-icon">
                                                                                        <svg xmlns="http://www.w3.org/2000/svg"
                                                                                            width="24" height="24"
                                                                                            viewBox="0 0 24 24"
                                                                                            fill="none"
                                                                                            stroke="currentColor"
                                                                                            stroke-width="2"
                                                                                            stroke-linecap="round"
                                                                                            stroke-linejoin="round"
                                                                                            class="feather feather-trash-2">
                                                                                            <polyline
                                                                                                points="3 6 5 6 21 6">
                                                                                            </polyline>
                                                                                            <path
                                                                                                d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2">
                                                                                            </path>
                                                                                            <line x1="10" y1="11"
                                                                                                x2="10" y2="17"></line>
                                                                                            <line x1="14" y1="11"
                                                                                                x2="14" y2="17"></line>
                                                                                        </svg>
                                                                                    </span>
                                                                                </a>
                                                                            </div>
                                                                        </div>
                                                                    </td>
                                                                </tr>
                                                                <% } } %>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <!-- /Page Body -->
                    </div>
                    <!-- /Page Body -->
                </div>

                <!-- Page Footer -->
                <%- include('includes/footer.ejs'); %>

            </div>
            <!-- /Main Content -->
    </div>
    <!-- /Wrapper -->

    <!-- jQuery -->
    <script src="/vendors/jquery/dist/jquery.min.js"></script>

    <!-- Bootstrap Core JS -->
    <script src="/vendors/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <!-- FeatherIcons JS -->
    <script src="/dist/js/feather.min.js"></script>

    <!-- Fancy Dropdown JS -->
    <script src="/dist/js/dropdown-bootstrap-extended.js"></script>

    <!-- Simplebar JS -->
    <script src="/vendors/simplebar/dist/simplebar.min.js"></script>

    <!-- Data Table JS -->
    <script src="/vendors/datatables.net/js/jquery.dataTables.min.js"></script>
    <script src="/vendors/datatables.net-bs5/js/dataTables.bootstrap5.min.js"></script>
    <script src="/vendors/datatables.net-select/js/dataTables.select.min.js"></script>

    <!-- Daterangepicker JS -->
    <script src="/vendors/moment/min/moment.min.js"></script>
    <script src="/vendors/daterangepicker/daterangepicker.js"></script>
    <script src="/dist/js/daterangepicker-data.js"></script>

    <!-- Amcharts Maps JS -->
    <script src="/vendors/@amcharts/amcharts4/core.js"></script>
    <script src="/vendors/@amcharts/amcharts4/maps.js"></script>
    <script src="/vendors/@amcharts/amcharts4-geodata/worldLow.js"></script>
    <script src="/vendors/@amcharts/amcharts4-geodata/worldHigh.js"></script>
    <script src="/vendors/@amcharts/amcharts4/themes/animated.js"></script>

    <!-- Apex JS -->
    <script src="/vendors/apexcharts/dist/apexcharts.min.js"></script>

    <!-- Init JS -->
    <script src="/dist/js/init.js"></script>
    <script src="/dist/js/chips-init.js"></script>
    <script src="/dist/js/dashboard-data.js"></script>

    <!-- Toastr  -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/2.0.1/js/toastr.js"></script>

    <script>

        $(document).ready(function () {
            const urlParams = new URLSearchParams(window.location.search);
            const error_msg = urlParams.get('error_msg');
            const success_msg = urlParams.get('success_msg');

            if (error_msg === 'Error! Please try again.') {
                toastr.error(
                    error_msg,
                    'Error',
                    {
                        timeOut: 2000,
                        fadeOut: 2000,
                        onHidden: function () {
                            window.location.href = window.location.pathname;
                        }
                    }
                );
            }

            if (success_msg.length > 0) {
                toastr.success(
                    success_msg,
                    'Success'
                );
            }
        });

        $("#btnSave").click(function () {
            var sub_category_name = $("input[name='sub_category_name']").val();
            var cat = $('#category_code').find(":selected").val();

            if (!sub_category_name || cat == "Select Category") {
                toastr.error(
                    'Please fill required fields!','ERROR',
                    {timeOut: 2000,fadeOut: 2000,}
                );
            } else {
                $("#formSubCat").submit();
            }
        });

        // Delete Process
        $(document).on("click", "#openDeleteModal", function () {
            var code = $(this).data('id');
            $(".modal-body #mainCatDeleteCode").val(code);
            $('#delete_info').modal('show');
        });

        function clickbtnDelete() {
            var code = $(".modal-body #mainCatDeleteCode").val();
            $.ajax({
                url: 'http://app360dev-001-site5.dtempurl.com/api/ECommerce/Admin/EcomSubCategory2/' + code,
                type: 'DELETE',
                headers: {
                    Authorization: 'Bearer ' + '<%=current_user.auth.token%>'
                },
                success: function (res) {
                    toastr.success(
                        'This item deleted successfully.',
                        'Success',
                        {
                            timeOut: 2000,
                            fadeOut: 1000,
                            onHidden: function () {
                                window.location.href = window.location.pathname;
                            }
                        }
                    );
                }
            })
        }

        // View Process
        $(document).on("click", "#openViewModal", function () {
            var code = $(this).data('id');
            $.ajax({
                url: 'http://app360dev-001-site5.dtempurl.com/api/ECommerce/Admin/EcomSubCategory2/' + code,
                type: 'GET',
                headers: {
                    Authorization: 'Bearer ' + '<%=current_user.auth.token%>'
                },
                success: function (res) {
                    //console.log(res.content);
                    $(".modal-body #main_name").val(res.content.EcomCategoryName);
                    $(".modal-body #cat_name").val(res.content.EcomSubCategory1Name);
                    $(".modal-body #code").val(res.content.Code);
                    $(".modal-body #name").val(res.content.Name);
                    $(".modal-body #created_by").val(res.content.CreatedBy);
                    $(".modal-body #updated_by").val(res.content.UpdatedBy);
                    $(".modal-body #created_date").val(moment.utc(res.content.CreatedDate).local().format('YYYY-MM-DD HH:mm a'));
                    if(res.content.UpdatedDate != null){
                    $(".modal-body #updated_date").val(moment.utc(res.content.UpdatedDate).local().format('YYYY-MM-DD HH:mm a'));
                    }
                    $('#view_info').modal('show');
                }
            })


        });

        // Edit Process 
        $(document).on("click", "#openEditModal", function () {
            var value = $(this).data('id');
            let code = value.split(':')[0];
            let name = value.split(':')[1];
            $(".modal-body #code").val(code);
            $(".modal-body #name").val(name);
            $('#edit_info').modal('show');
        });

        function clickbtnUpdate() {
            var code = $(".modal-body #code").val();
            var changed_name = $(".modal-body #name").val();
            //console.log(changed_name)
            $("#btnSubmit").attr("href", "/subcategory/update/" + code + "&" + changed_name);
        }
    </script>

    <!-- Edit Modal -->
    <div id="edit_info" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                    <h5 class="mb-5">Edit Sub Category</h5>
                    <form>
                        <div class="row gx-3">
                            <div class="col-sm-12 form-group">
                                <label class="form-label">Sub Category Name</label>
                                <input type="hidden" name="code" id="code" />
                                <input class="form-control" type="text" name="name" id="name" />
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer align-items-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <a href="" type="button" class="btn btn-primary" onclick="clickbtnUpdate();"
                        id="btnSubmit">Update</a>
                </div>
            </div>
        </div>
    </div>
    <!-- /Edit Modal -->

    <!-- View Modal -->
    <div id="view_info" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true" style="font-size: 14px;">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">×</span>
                    </button>
                    <h5 class="mb-5">View Sub Category Info</h5>
                    <form>
                        <div class="row gx-3">
                            <div class="col-sm-6 form-group">
                                <label class="form-label">Main Category</label>
                                <input class="form-control" type="text" id="main_name" readonly />
                            </div>
                            <div class="col-sm-6 form-group">
                                <label class="form-label">Category</label>
                                <input class="form-control" type="text" id="cat_name" readonly />
                            </div>
                            <div class="col-sm-6 form-group">
                                <label class="form-label">Code</label>
                                <input class="form-control" type="text" id="code" readonly />
                            </div>
                            <div class="col-sm-6 form-group">
                                <label class="form-label">Name</label>
                                <input class="form-control" type="text" id="name" readonly />
                            </div>
                            <div class="col-sm-6 form-group">
                                <label class="form-label">Created Date</label>
                                <input class="form-control" type="text" id="created_date" readonly />
                            </div>
                            <div class="col-sm-6 form-group">
                                <label class="form-label">Created By</label>
                                <input class="form-control" type="text" id="created_by" readonly />
                            </div>
                            <div class="col-sm-6 form-group">
                                <label class="form-label">Updated Date</label>
                                <input class="form-control" type="text" id="updated_date" readonly />
                            </div>
                            <div class="col-sm-6 form-group">
                                <label class="form-label">Updated By</label>
                                <input class="form-control" type="text" id="updated_by" readonly />
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer align-items-center">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </div>
        </div>
    </div>
    <!-- /View Modal -->

    <!-- Delete Modal -->
    <div id="delete_info" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <input type="hidden" name="mainCatDeleteCode" id="mainCatDeleteCode" />
                    <h5 style="text-align: center;">Are you sure you want to delete this sub category?</h5>
                </div>
                <div class="modal-footer align-items-center">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal"
                        style="margin-right: 20px; width: 100px;">Cancel</button>
                    <a href="" type="button" class="btn btn-danger" onclick="clickbtnDelete();"
                        style="margin-right: 120px; width: 100px;" data-bs-dismiss="modal" id="btnDelete">Delete</a>
                </div>
            </div>
        </div>
    </div>
    <!-- /Delete Modal -->

</body>

</html>